.Dd $Mdocdate: March 13 2016 $
.Dt KFCGI 8
.Os
.Sh NAME
.Nm kfcgi
.Nd FastCGI server for kcgi applications
.\" .Sh LIBRARY
.\" For sections 2, 3, and 9 only.
.\" Not used in OpenBSD.
.Sh SYNOPSIS
.Nm kfcgi
.Op Fl dv
.Op Fl l Ar backlog
.Op Fl n Ar workers
.Op Fl p Ar chroot
.Op Fl s Ar sockpath
.Op Fl u Ar sockuser
.Op Fl U Ar procuser
.Ar prog Op arg0...
.Sh DESCRIPTION
The
.Nm
server starts up
.Ar workers
processes of
.Ar prog
to handle FastCGI connections.
By default, it opens the socket
.Pa /var/www/run/httpd.sock
in mode 0660 under the current user and group, changes to a file-system
jail in
.Pa /var/www ,
daemonises and opens its system log,
then starts 3 workers executing
.Ar prog ,
which must exist relative to the file-system jail root.
The arguments are as follows:
.Bl -tag -width Ds
.It Fl d
Do not daemonise and, in addition to syslog, print messages to standard
error.
.It Fl v
Be more verbose in output.
This can produce a
.Em lot
of output.
.It Fl l Ar backlog
The connection backlog.
If unspecified or zero, this is set to the value of
.Fl n
times two.
If too small, the web-server will not be able to pass in new connections.
.It Fl n Ar workers
The number of workers >1.
.It Fl p Ar chroot
Location of file-system jail.
This is mandatory: use the root directory if you insist on being
insecure.
.It Fl s Ar sockpath
Alternative socket path.
.It Fl u Ar sockuser
The user in whose name (user and group) the socket is created.
.It Fl U Ar procuser
The user in whose name the process is dropped.
.El
.Pp
To properly stop a
.Nm
server, send it a
.Dv SIGTERM .
If you send a
.Dv SIGHUP
to the process, it will restart all workers.
.\" .Sh CONTEXT
.\" For section 9 functions only.
.\" .Sh IMPLEMENTATION NOTES
.\" Not used in OpenBSD.
.\" .Sh RETURN VALUES
.\" For sections 2, 3, and 9 function return values only.
.\" .Sh ENVIRONMENT
.\" For sections 1, 6, 7, and 8 only.
.\" .Sh FILES
.Sh EXIT STATUS
.Ex -std
.\" For sections 1, 6, and 8 only.
.Sh EXAMPLES
On OpenBSD, the default user for the web server is
.Dq www .
Assuming we have a server that doesn't need any files, we can run the
following to keep it in a safe jail:
.Pp
.D1 # kfcgi -u www -U www -- /fcgi-bin/prog
.Pp
This will execute
.Pa /fcgi-bin/prog
within the default file-system jail of
.Pa /var/www
as user
.Dq www .
It will create the default socket
.Pa /var/www/run/httpd.sock
in mode 0660 as user
.Dq www .
.\" .Sh DIAGNOSTICS
.\" For sections 1, 4, 6, 7, 8, and 9 printf/stderr messages only.
.\" .Sh ERRORS
.\" For sections 2, 3, 4, and 9 errno settings only.
.Sh SEE ALSO
.Xr kcgi 3
.\" .Sh STANDARDS
.\" .Sh HISTORY
.\" .Sh AUTHORS
.\" .Sh CAVEATS
.\" .Sh BUGS
.\" .Sh SECURITY CONSIDERATIONS
.\" Not used in OpenBSD.
